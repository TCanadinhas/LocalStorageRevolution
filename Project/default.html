<!DOCTYPE html>
<html>
<body onLoad = 'Start()'>

<center>
    <canvas id = 'tela' width = '800' height= '600' style = 'border:1px solid #000000; background: #000000'>
	</canvas>
</center>

<script>
	
	function Start()
	{
		loop();
	}
	
	var canvas = document.getElementById('tela');
	var context = canvas.getContext('2d');
	
	var x = (canvas.width / 2) - (w/2);
	var y = (canvas.height / 2) - (h/2);
	var w = 40;
	var h = w;
	var color = '#CC0099';
	var speed = 10;
	
	var comandos = new Image();
	comandos.src = 'tela.png';
	
	var moveLeft = false;
	var moveUp = false;
	var moveRight = false;
	var moveDown = false;
	
	if(localStorage.getItem('xRect') != (undefined || null)) x = parseInt(localStorage.getItem('xRect'));
	
	if(localStorage.getItem('yRect') != (undefined || null)) y = parseInt(localStorage.getItem('yRect'));
	
	function keyDown(e)
	{
		
		switch (e.keyCode)
		{
			case 37:
				moveLeft = true;
				console.log('moveLeft: '+ moveLeft);
				break;
				
			case 38:
				moveUp = true;
				console.log('moveUp: '+ moveUp);
				break;
				
			case 39:
				moveRight = true;
				console.log('moveRight: '+ moveRight);
				break;
				
			case 40:
				moveDown = true;
				console.log('moveDown: '+ moveDown);
				break;
				
			case 82:
				reset();
				break;
				
			default:
				console.log('keyDown: '+ e.keyCode);
				break;
		}
	}
	
	
	function keyUp(e)
	{
		
		switch(e.keyCode)
		{
			case 37:
				moveLeft = false;
				//console.log('moveLeft: '+ moveLeft);
				break;
				
			case 38:
				moveUp = false;
				//console.log('moveUp: '+ moveUp);
				break;
				
			case 39:
				moveRight = false;
				//console.log('moveRight: '+ moveRight);
				break;
				
			case 40:
				moveDown = false;
				//console.log('moveDown: '+ moveDown);
				break;
		}
	}
	
	document.addEventListener('keydown',keyDown,true);
	document.addEventListener('keyup',keyUp,true);
	
	function reset()
	{
		console.log('reset');
		x = (canvas.width / 2) - (w/2);
		y = (canvas.height / 2) - (h/2);
	}
	
	function move()
	{		
		if(moveLeft) x -= speed;

		if(moveUp) y -= speed;
		
		if(moveRight) x += speed;
		
		if(moveDown) y += speed;
	}
	
	
	function colision()
	{
		if(x < 0) x = 0;
		if(x + w > canvas.width) x = canvas.width - w;
		
		if(y < 0) y = 0;
		if(y + h > canvas.height) y = canvas.height - h;
	}
	
	function update()
	{
		localStorage.setItem('xRect',x);
		localStorage.setItem('yRect',y);
		move();
		colision();
	}
	
	function drawPlay(x,y,w,h,color) 
	{
		context.fillStyle = color;
		context.fillRect(x,y,w,h);
    }
	
	function draw()
	{
		context.clearRect(0,0,canvas.width,canvas.height);
		drawPlay(x,y,w,h,color);
		context.drawImage(comandos,0,0,canvas.width,canvas.height);
	}
	
	function loop()
	{
		draw();
		update();
		
		setTimeout(loop,30)
	}
	
	
	
</script>

</body>
</html>